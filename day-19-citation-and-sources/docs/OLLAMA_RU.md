# Руководство по настройке Ollama

Это руководство описывает процесс настройки Ollama для использования с модулем Document Indexer.

## Что такое Ollama?

Ollama — это инструмент для локального запуска больших языковых моделей. Document Indexer использует Ollama для генерации эмбеддингов (векторных представлений текста) для семантического поиска с помощью модели `nomic-embed-text`.

## Установка

### macOS
```bash
brew install ollama
```

### Linux
```bash
curl -fsSL https://ollama.com/install.sh | sh
```

### Windows
Скачайте установщик с [ollama.com/download](https://ollama.com/download)

## Настройка

### 1. Запуск сервера Ollama

```bash
ollama serve
```

Сервер запустится по адресу `http://localhost:11434` по умолчанию.

### 2. Загрузка модели для эмбеддингов

```bash
ollama pull nomic-embed-text
```

Эта команда загрузит модель `nomic-embed-text` (~270 МБ), оптимизированную для генерации текстовых эмбеддингов.

### 3. Проверка установки

```bash
# Проверка работы сервера
curl http://localhost:11434/api/tags

# Тестирование генерации эмбеддингов
curl http://localhost:11434/api/embed -d '{
  "model": "nomic-embed-text",
  "input": ["Привет, мир!"]
}'
```

## Запуск индексатора

После настройки Ollama:

```bash
./gradlew :indexer:run
```

Приложение выполнит следующие действия:
1. Проверит доступность Ollama (зелёный индикатор = подключено)
2. Позволит выбрать файлы или директории для индексации
3. Сгенерирует эмбеддинги с помощью Ollama
4. Сохранит проиндексированный контент в базе данных SQLite
5. Обеспечит семантический поиск по проиндексированным документам

## Конфигурация

### Настройки по умолчанию

| Параметр | Значение |
|----------|----------|
| Базовый URL | `http://localhost:11434` |
| Модель | `nomic-embed-text` |
| Размер батча | 10 текстов за запрос |
| База данных | `~/.document-indexer/indexer.db` |

### Настройки чанков

| Параметр | По умолчанию |
|----------|--------------|
| Стратегия | По символам |
| Размер чанка | 500 символов |
| Перекрытие | 50 символов |

## Поддерживаемые типы файлов

Индексатор поддерживает следующие расширения файлов по умолчанию:
- `.md` (Markdown)
- `.txt` (Обычный текст)

## Устранение неполадок

### Статус Ollama показывает "Offline"

1. Убедитесь, что Ollama запущен: `ollama serve`
2. Проверьте доступность порта: `curl http://localhost:11434/api/tags`
3. Убедитесь, что файрвол не блокирует порт 11434

### Генерация эмбеддингов не работает

1. Проверьте, что модель загружена: `ollama list`
2. Если модель отсутствует: `ollama pull nomic-embed-text`
3. Проверьте логи Ollama на наличие ошибок

### Медленная индексация

- Генерация эмбеддингов требует значительных ресурсов CPU/GPU
- Попробуйте индексировать меньше файлов за раз
- Убедитесь, что Ollama имеет достаточно ресурсов

### Проблемы с базой данных

База данных хранится по пути `~/.document-indexer/indexer.db`. Для сброса:
```bash
rm ~/.document-indexer/indexer.db
```

## Справочник по API

### Эндпоинт Ollama Embed

Индексатор использует эндпоинт `/api/embed`:

**Запрос:**
```json
{
  "model": "nomic-embed-text",
  "input": ["текст1", "текст2", ...]
}
```

**Ответ:**
```json
{
  "model": "nomic-embed-text",
  "embeddings": [[0.1, 0.2, ...], [0.3, 0.4, ...]]
}
```

### Размерность эмбеддингов

Модель `nomic-embed-text` генерирует 768-мерные векторы.

## Альтернативные модели

Вы можете использовать другие модели для эмбеддингов, доступные в Ollama:

```bash
ollama pull mxbai-embed-large  # 1024 измерения
ollama pull all-minilm         # 384 измерения
```

Чтобы использовать другую модель, измените `OllamaApi.DEFAULT_MODEL` в коде.
